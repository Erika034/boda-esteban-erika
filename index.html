<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Boda Esteban & Erika · 26.04.2026</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400;1,600&family=Cinzel:wght@400;500&family=Jost:wght@200;300;400&display=swap" rel="stylesheet">
<style>
:root{
  --sage:#6b8c65;   --sage-l:#94b08d;  --sage-ll:#c8dcc4;
  --lilac:#7a5fa0;  --lilac-d:#5a4278; --lilac-l:#b09ec4;
  --mauve:#c4b0d8;  --mauve-l:#e0d5ee;
  --pearl:#e8e5df;  --cream:#f8f5ef;   --cream-d:#ede9e0;
  --gold:#c9a96e;   --gold-l:#e8d5b0;
  --dark:#2b2428;
  --env-body:#c2aed4; --env-mid:#a892bc; --env-deep:#7a5fa0;
}
*,::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%;}
body{background:var(--cream);font-family:'Jost',sans-serif;font-weight:300;color:var(--dark);overflow-x:hidden;min-height:100vh;}

.layer{
  position:fixed;inset:0;z-index:200;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:16px;overflow:hidden;
  transition:opacity .9s ease, visibility .9s ease;
}
.layer.off{opacity:0;visibility:hidden;pointer-events:none;}
.dark-layer{
  background:radial-gradient(ellipse at 70% 20%, #1a0f2e 0%, #0d1a0a 60%, #160c28 100%);
}

.glow{position:absolute;border-radius:50%;filter:blur(110px);pointer-events:none;animation:glowPulse 6s ease-in-out infinite;}
.glow-a{width:550px;height:550px;background:var(--lilac);opacity:.13;top:-180px;right:-180px;animation-delay:0s;}
.glow-b{width:480px;height:480px;background:var(--sage);opacity:.12;bottom:-150px;left:-150px;animation-delay:-3s;}
@keyframes glowPulse{0%,100%{opacity:.1;transform:scale(1);}50%{opacity:.18;transform:scale(1.06);}}

.flora-corner{position:absolute;pointer-events:none;}
.flora-tl{top:-10px;left:-10px;width:clamp(160px,28vw,260px);transform:rotate(0deg);}
.flora-tr{top:-10px;right:-10px;width:clamp(160px,28vw,260px);transform:scaleX(-1);}
.flora-bl{bottom:-10px;left:-10px;width:clamp(140px,24vw,230px);transform:rotate(180deg) scaleX(-1);}
.flora-br{bottom:-10px;right:-10px;width:clamp(140px,24vw,230px);transform:rotate(180deg);}

#s2{text-align:center;gap:0;}

.env-photo-wrap{
  position:relative;width:min(300px,76vw);height:min(190px,30vw);
  border-radius:14px;overflow:hidden;margin-bottom:16px;
  box-shadow:0 14px 48px rgba(0,0,0,.5);animation:riseUp .9s ease both;flex-shrink:0;
}
.env-photo-wrap img{width:100%;height:100%;object-fit:cover;object-position:center 25%;display:block;}
.env-photo-wrap::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom, rgba(0,0,0,.06) 45%, rgba(13,26,10,.82) 100%);}
.photo-names-overlay{position:absolute;bottom:11px;left:0;right:0;text-align:center;z-index:2;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(1rem,3.5vw,1.4rem);color:#fff;text-shadow:0 2px 14px rgba(0,0,0,.7);letter-spacing:.05em;}

.env-subtitle{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(1.3rem,4vw,1.9rem);color:var(--gold-l);margin-bottom:3px;letter-spacing:.04em;animation:riseUp .8s .1s ease both;}
.env-reserved{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(.9rem,2.8vw,1.2rem);color:var(--mauve-l);animation:riseUp .8s .18s ease both;}
.env-num{font-family:'Cinzel',serif;font-size:clamp(2.8rem,9vw,5rem);color:#fff;line-height:1;animation:riseUp .8s .24s ease both;}
.env-places{font-size:.68rem;letter-spacing:.36em;text-transform:uppercase;color:var(--sage-l);margin-bottom:3px;animation:riseUp .8s .3s ease both;}
.env-honor{font-size:.66rem;letter-spacing:.28em;text-transform:uppercase;color:rgba(255,255,255,.35);margin-bottom:12px;animation:riseUp .8s .36s ease both;}
.env-para{font-size:.62rem;letter-spacing:.3em;text-transform:uppercase;color:var(--mauve-l);animation:riseUp .8s .42s ease both;}
.env-gname{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(1.5rem,5vw,2.5rem);color:#fff;margin-bottom:14px;animation:riseUp .8s .48s ease both;}

.env-scene{position:relative;width:min(290px,75vw);cursor:pointer;filter:drop-shadow(0 22px 52px rgba(0,0,0,.55));animation:riseUp .8s .54s ease both;flex-shrink:0;transition:filter .35s ease;}
.env-scene:hover{filter:drop-shadow(0 28px 64px rgba(122,95,160,.5));}
.env-scene:hover .eb-back{filter:brightness(1.08);}
.env-body-rect{width:100%;padding-bottom:68%;position:relative;}
.eb-back{position:absolute;inset:0;border-radius:5px 5px 10px 10px;background:linear-gradient(155deg, #cdbade 0%, #b8a4cc 55%, #9a88b5 100%);box-shadow:inset 0 -8px 22px rgba(0,0,0,.2);transition:filter .35s;}
.eb-shine{position:absolute;inset:0;border-radius:5px 5px 10px 10px;background:linear-gradient(135deg,rgba(255,255,255,.18) 0%,transparent 50%);pointer-events:none;}
.eb-cl{position:absolute;top:0;left:0;right:50%;bottom:0;background:linear-gradient(to bottom-right,rgba(255,255,255,.14),transparent 55%);pointer-events:none;}
.eb-cr{position:absolute;top:0;left:50%;right:0;bottom:0;background:linear-gradient(to bottom-left,rgba(255,255,255,.1),transparent 55%);pointer-events:none;}
.eb-inner{position:absolute;left:9%;right:9%;bottom:10%;height:68%;background:linear-gradient(148deg,#f8f5ef 0%,#ede7f5 100%);border-radius:4px;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px 8px;opacity:0;transform:translateY(26px);transition:opacity .65s .45s ease,transform .65s .45s ease;}
.eb-inner.vis{opacity:1;transform:translateY(0);}
.eb-inner .ii-top{font-size:.42rem;letter-spacing:.32em;text-transform:uppercase;color:var(--lilac);margin-bottom:4px;}
.eb-inner .ii-names{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(.75rem,2.2vw,1.05rem);color:var(--dark);text-align:center;line-height:1.3;}
.eb-inner .ii-names span{color:var(--lilac);}
.eb-inner .ii-date{font-size:.44rem;letter-spacing:.22em;color:var(--sage);margin-top:6px;}
.eb-inner::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%) translateY(-50%);width:48px;height:24px;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'%3E%3Cellipse cx='12' cy='18' rx='7' ry='14' fill='%236b8c65' opacity='.7' transform='rotate(-25 12 18)'/%3E%3Cellipse cx='30' cy='10' rx='6' ry='12' fill='%237a5fa0' opacity='.65' transform='rotate(5 30 10)'/%3E%3Cellipse cx='48' cy='18' rx='7' ry='14' fill='%236b8c65' opacity='.7' transform='rotate(25 48 18)'/%3E%3Ccircle cx='12' cy='5' r='4' fill='%237a5fa0' opacity='.6'/%3E%3Ccircle cx='48' cy='5' r='4' fill='%236b8c65' opacity='.6'/%3E%3C/svg%3E") center/contain no-repeat;}
.eb-sl{position:absolute;bottom:0;left:0;right:50%;height:36%;z-index:3;background:#8272aa;clip-path:polygon(0 100%,100% 0,0 0);}
.eb-sr{position:absolute;bottom:0;left:50%;right:0;height:36%;z-index:3;background:#8272aa;clip-path:polygon(0 0,100% 0,100% 100%);}
.eb-sb{position:absolute;bottom:0;left:0;right:0;height:36%;z-index:4;background:linear-gradient(to bottom,#b09cc8,#9a88b5);clip-path:polygon(0 100%,50% 0,100% 100%);}
.eb-flap{position:absolute;top:0;left:0;right:0;height:44%;z-index:10;background:linear-gradient(175deg,#c8b6dc 0%,#b5a0cc 100%);clip-path:polygon(0 0,50% 100%,100% 0);transform-origin:top center;transition:transform 1.1s cubic-bezier(.35,0,.15,1);filter:drop-shadow(0 4px 8px rgba(0,0,0,.28));}
.eb-flap::after{content:'';position:absolute;inset:0;background:linear-gradient(130deg,rgba(255,255,255,.18),transparent 52%);clip-path:polygon(0 0,50% 100%,100% 0);}
.eb-flap.open{transform:rotateX(-180deg);}
.wax{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) translateY(20%);z-index:12;width:56px;height:56px;border-radius:50%;background:radial-gradient(circle at 32% 32%,var(--gold-l),var(--gold) 55%,#9a6e22 100%);box-shadow:0 6px 22px rgba(0,0,0,.42),inset 0 1px 5px rgba(255,255,255,.3);display:grid;place-items:center;transition:transform .55s ease,opacity .55s ease;}
.wax.gone{opacity:0;transform:translate(-50%,-50%) translateY(20%) scale(0);}
.wax-inner{width:38px;height:38px;border-radius:50%;border:1.5px solid rgba(80,45,5,.25);display:grid;place-items:center;}
.wax-text{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:12px;color:rgba(55,28,5,.7);text-align:center;line-height:1.1;user-select:none;pointer-events:none;}
.env-hint{margin-top:14px;font-size:.61rem;letter-spacing:.35em;text-transform:uppercase;color:rgba(255,255,255,.35);animation:breathe 3s ease-in-out infinite;transition:opacity .5s;}
.env-hint.gone{opacity:0!important;}
@keyframes breathe{0%,100%{opacity:.2;}50%{opacity:.75;}}

.music-btn{position:fixed;bottom:22px;right:22px;z-index:9999;width:44px;height:44px;border-radius:50%;border:none;cursor:pointer;background:rgba(255,255,255,.12);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.18);display:grid;place-items:center;transition:all .3s;box-shadow:0 4px 16px rgba(0,0,0,.28);}
.music-btn:hover{background:rgba(255,255,255,.22);transform:scale(1.1);}
.music-btn.on{background:rgba(122,95,160,.45);}
.music-icon{width:18px;height:18px;fill:none;stroke:#fff;stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round;}

#s3{position:relative;z-index:1;display:none;}
#s3.active{display:block;}

.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:0 24px 90px;position:relative;background:linear-gradient(165deg,#eaf0e7 0%,var(--cream) 50%,#ece8f4 100%);overflow:hidden;}
.h-orb{position:absolute;border-radius:50%;pointer-events:none;}
.h-orb-a{width:700px;height:700px;background:radial-gradient(circle,rgba(122,95,160,.09),transparent 70%);top:-220px;right:-220px;}
.h-orb-b{width:600px;height:600px;background:radial-gradient(circle,rgba(107,140,101,.08),transparent 70%);bottom:-200px;left:-200px;}
.hbot{position:absolute;pointer-events:none;}
.hbot-tl{top:0;left:0;width:clamp(180px,28vw,280px);opacity:.22;}
.hbot-tr{top:0;right:0;width:clamp(180px,28vw,280px);opacity:.22;transform:scaleX(-1);}
.hbot-bl{bottom:0;left:0;width:clamp(160px,24vw,240px);opacity:.18;transform:scaleY(-1);}
.hbot-br{bottom:0;right:0;width:clamp(160px,24vw,240px);opacity:.18;transform:scale(-1);}

.hero-photo{width:100%;height:min(56vw,430px);position:relative;overflow:hidden;flex-shrink:0;}
.hero-photo img{width:100%;height:100%;object-fit:cover;object-position:center 28%;display:block;}
.hero-photo::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,.08) 38%,rgba(248,245,239,.96) 100%);}
.hp-flora{position:absolute;z-index:2;pointer-events:none;opacity:.5;}
.hp-fl-tl{top:-8px;left:-8px;width:clamp(120px,20vw,200px);transform:rotate(-5deg);}
.hp-fl-tr{top:-8px;right:-8px;width:clamp(120px,20vw,200px);transform:rotate(8deg) scaleX(-1);}

.hero-content{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;padding-top:26px;}
.h-nuestraboda{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(1.5rem,4.5vw,2.4rem);color:var(--gold);margin-bottom:5px;letter-spacing:.04em;animation:riseUp .8s ease both;}
.h-names{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(2.8rem,9vw,6.5rem);font-weight:300;line-height:1.05;color:var(--dark);animation:riseUp .8s .12s ease both;}
.h-amp{font-size:.5em;color:var(--lilac);}
.h-div{display:flex;align-items:center;gap:14px;margin:22px auto;width:220px;animation:riseUp .8s .24s ease both;}
.h-line{flex:1;height:1px;background:linear-gradient(to right,transparent,var(--lilac-l),transparent);}
.h-leaf{color:var(--sage);font-size:.75rem;letter-spacing:0;}
.h-date{animation:riseUp .8s .36s ease both;}
.h-big{font-family:'Cormorant Garamond',serif;font-size:clamp(2.2rem,6.5vw,4.2rem);font-weight:300;color:var(--sage);line-height:1;}
.h-sub{font-size:.71rem;letter-spacing:.3em;text-transform:uppercase;color:var(--lilac-l);margin-top:7px;}
.h-gnote{margin-top:16px;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.08rem;color:var(--lilac-d);animation:riseUp .8s .48s ease both;}
.scroll-cue{position:absolute;bottom:28px;left:50%;transform:translateX(-50%);font-size:.6rem;letter-spacing:.32em;text-transform:uppercase;color:var(--lilac-l);animation:riseUp 1s .9s ease both,breathe 3s 2s infinite;}

.sec{padding:82px 24px;max-width:760px;margin:0 auto;opacity:0;transform:translateY(24px);transition:opacity .75s,transform .75s;}
.sec.vis{opacity:1;transform:translateY(0);}
.sec-lbl{font-size:.65rem;letter-spacing:.4em;text-transform:uppercase;color:var(--sage);margin-bottom:10px;}
.sec-title{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(1.9rem,5.5vw,2.9rem);font-weight:300;color:var(--dark);line-height:1.15;margin-bottom:18px;}
.sec-prose{font-size:.9rem;line-height:1.9;color:#6a6060;max-width:520px;}
.ornament{text-align:center;padding:10px 0;color:var(--lilac-l);letter-spacing:.5em;opacity:.65;font-size:.76rem;}

.gallery{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:34px;}
.g-cell{border-radius:14px;overflow:hidden;position:relative;box-shadow:0 6px 24px rgba(122,95,160,.15);}
.g-cell.wide{grid-column:1/-1;aspect-ratio:16/7;}
.g-cell:not(.wide){aspect-ratio:4/5;}
.g-cell img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .5s ease;}
.g-cell:hover img{transform:scale(1.04);}
.g-cell::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,transparent 55%,rgba(122,95,160,.12));pointer-events:none;}

.timeline{margin-top:36px;position:relative;}
.timeline::before{content:'';position:absolute;left:23px;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,var(--mauve-l),var(--sage-ll),transparent);}
.t-row{display:flex;gap:26px;margin-bottom:32px;align-items:flex-start;}
.t-ico{flex-shrink:0;width:46px;height:46px;border-radius:50%;background:#fff;border:1.5px solid var(--mauve-l);display:grid;place-items:center;position:relative;z-index:1;box-shadow:0 4px 14px rgba(176,158,196,.18);}
.t-ico svg{width:20px;height:20px;fill:none;stroke:var(--lilac);stroke-width:1.6;stroke-linecap:round;stroke-linejoin:round;}
.t-time{font-size:.66rem;letter-spacing:.22em;text-transform:uppercase;color:var(--lilac);margin-bottom:3px;}
.t-event{font-family:'Cormorant Garamond',serif;font-size:1.28rem;font-style:italic;margin-bottom:4px;}
.t-desc{font-size:.82rem;color:#888;line-height:1.65;}

.map-card{background:#fff;border-radius:18px;overflow:hidden;box-shadow:0 6px 48px rgba(122,95,160,.12);margin-top:36px;}
.map-card iframe{width:100%;height:290px;border:none;display:block;}
.map-foot{padding:20px 26px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;border-top:1px solid var(--pearl);}
.map-addr strong{display:block;font-family:'Cormorant Garamond',serif;font-size:1.15rem;font-style:italic;margin-bottom:3px;}
.map-addr span{font-size:.81rem;color:#888;}

.pal-card{background:linear-gradient(135deg,#eef2eb 0%,#ede8f5 100%);border-radius:18px;padding:38px 34px;margin-top:36px;display:flex;flex-wrap:wrap;gap:30px;align-items:center;}
.swatches{display:flex;gap:10px;flex-wrap:wrap;}
.sw{width:46px;height:46px;border-radius:50%;box-shadow:0 4px 14px rgba(0,0,0,.14);}
.pal-txt h3{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-style:italic;margin-bottom:9px;}
.pal-txt p{font-size:.84rem;color:#777;line-height:1.78;}
.pal-note{margin-top:9px;font-size:.75rem;color:var(--lilac);font-style:italic;}

.form-card{background:#fff;border-radius:22px;padding:44px 40px;box-shadow:0 6px 58px rgba(107,140,101,.1);margin-top:36px;}
.rsvp-notice{background:#f0edf8;border-left:3px solid var(--lilac-l);border-radius:8px;padding:12px 15px;font-size:.8rem;color:#6a5888;line-height:1.65;margin-bottom:22px;}
.g-slots{display:flex;flex-direction:column;gap:13px;margin-bottom:22px;}
.g-slot{background:var(--cream-d);border:1.5px solid #ddd8d0;border-radius:11px;padding:15px 17px;}
.g-slot-lbl{font-size:.64rem;letter-spacing:.22em;text-transform:uppercase;color:var(--sage);margin-bottom:9px;}
.slot-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;}
.slot-row input{padding:11px 12px;border:1.5px solid #ddd8d0;border-radius:9px;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1rem;color:var(--dark);background:#fff;outline:none;width:100%;transition:border-color .25s;}
.slot-row input:focus{border-color:var(--lilac-l);}
.f-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;}
.f-field{display:flex;flex-direction:column;gap:7px;}
.f-field.full{grid-column:1/-1;}
.f-field label{font-size:.65rem;letter-spacing:.24em;text-transform:uppercase;color:var(--lilac);}
.f-field input,.f-field textarea{padding:12px 14px;border:1.5px solid #ddd8d0;border-radius:10px;font-family:'Jost',sans-serif;font-size:.89rem;color:var(--dark);background:var(--cream);outline:none;width:100%;transition:border-color .25s,background .25s;}
.f-field input:focus,.f-field textarea:focus{border-color:var(--lilac-l);background:#fff;}
.f-field textarea{resize:vertical;min-height:82px;}
.radio-grp{display:flex;gap:18px;flex-wrap:wrap;margin-top:4px;}
.r-opt{display:flex;align-items:center;gap:8px;font-size:.86rem;cursor:pointer;}
.r-opt input{width:auto;accent-color:var(--lilac);}
.f-submit{text-align:center;margin-top:28px;}

.btn{display:inline-flex;align-items:center;gap:7px;padding:12px 28px;border-radius:50px;font-family:'Jost',sans-serif;font-weight:300;font-size:.77rem;letter-spacing:.18em;text-transform:uppercase;text-decoration:none;cursor:pointer;border:none;transition:all .3s;}
.btn-lilac{background:var(--lilac);color:#fff;}
.btn-lilac:hover{background:var(--lilac-d);transform:translateY(-2px);box-shadow:0 10px 24px rgba(122,95,160,.38);}
.btn-sage{background:var(--sage);color:#fff;}
.btn-sage:hover{background:#5a7855;transform:translateY(-2px);}
.btn-outline{background:transparent;color:var(--lilac);border:1.5px solid var(--lilac-l);}
.btn-outline:hover{background:var(--mauve-l);transform:translateY(-2px);}
.btn-gold{background:linear-gradient(135deg,#b8892e,var(--gold));color:#fff;}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(201,169,110,.4);}

.form-ok{display:none;text-align:center;padding:34px 20px;background:linear-gradient(135deg,#eef2eb,#ede8f5);border-radius:14px;margin-top:18px;}
.form-ok .ok-title{font-family:'Cormorant Garamond',serif;font-size:1.8rem;font-style:italic;color:var(--dark);margin-bottom:8px;}
.form-ok p{font-size:.86rem;color:#888;line-height:1.7;}
.download-section{margin-top:18px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap;}

.site-footer{background:linear-gradient(160deg,#160f24 0%,#0e1a0c 100%);color:var(--pearl);text-align:center;padding:70px 24px 50px;position:relative;overflow:hidden;}
.site-footer::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 35% 50%,rgba(122,95,160,.09),transparent 60%),radial-gradient(ellipse at 68% 50%,rgba(107,140,101,.08),transparent 60%);}
.f-names{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(2.2rem,7vw,3.4rem);font-weight:300;color:var(--mauve-l);margin-bottom:12px;position:relative;}
.f-date{font-size:.7rem;letter-spacing:.36em;text-transform:uppercase;color:var(--gold-l);margin-bottom:8px;position:relative;}
.f-sub{font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,255,255,.2);position:relative;}

@media(max-width:520px){
  .f-grid,.slot-row{grid-template-columns:1fr;}
  .gallery{grid-template-columns:1fr;}
  .g-cell.wide{aspect-ratio:4/3;}
  .form-card{padding:28px 18px;}
  .pal-card{padding:28px 18px;}
}
@keyframes riseUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<button class="music-btn" id="musicBtn" onclick="toggleMusic()" title="Musica">
  <svg class="music-icon" id="musicIcon" viewBox="0 0 24 24">
    <path d="M9 18V5l12-2v13"/>
    <circle cx="6" cy="18" r="3"/>
    <circle cx="18" cy="16" r="3"/>
  </svg>
</button>

<!-- ENVELOPE SCREEN -->
<div id="s2" class="layer dark-layer">
  <div class="glow glow-a"></div>
  <div class="glow glow-b"></div>

  <svg class="flora-corner flora-tl" viewBox="0 0 280 340" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity=".9">
      <path d="M40 340 Q50 280 45 220 Q40 160 55 100 Q62 70 70 40" stroke="#5a7855" stroke-width="2" fill="none" stroke-linecap="round"/>
      <ellipse cx="22" cy="230" rx="18" ry="44" fill="#6b8c65" transform="rotate(-35 22 230)"/>
      <ellipse cx="18" cy="170" rx="16" ry="38" fill="#5a7855" transform="rotate(-28 18 170)"/>
      <ellipse cx="30" cy="110" rx="14" ry="32" fill="#7da877" transform="rotate(-20 30 110)"/>
      <ellipse cx="68" cy="200" rx="20" ry="46" fill="#6b8c65" transform="rotate(18 68 200)"/>
      <ellipse cx="72" cy="145" rx="16" ry="36" fill="#7da877" transform="rotate(24 72 145)"/>
      <ellipse cx="65" cy="88" rx="12" ry="28" fill="#5a7855" transform="rotate(15 65 88)"/>
      <circle cx="18" cy="188" r="10" fill="#7a5fa0" opacity=".8"/>
      <circle cx="16" cy="192" r="7" fill="#9070b8" opacity=".6"/>
      <circle cx="74" cy="120" r="12" fill="#6a4f90" opacity=".8"/>
      <circle cx="70" cy="124" r="8" fill="#8b6aac" opacity=".6"/>
      <circle cx="56" cy="58" r="9" fill="#7a5fa0" opacity=".75"/>
      <circle cx="58" cy="38" r="7" fill="#9878c0" opacity=".65"/>
      <ellipse cx="85" cy="70" rx="9" ry="20" fill="#8fba88" transform="rotate(30 85 70)"/>
      <ellipse cx="15" cy="130" rx="8" ry="18" fill="#94b08d" transform="rotate(-40 15 130)"/>
      <path d="M55 100 Q80 80 90 55" stroke="#6b8c65" stroke-width="1.2" fill="none" stroke-linecap="round" opacity=".6"/>
      <path d="M50 160 Q25 145 15 125" stroke="#6b8c65" stroke-width="1.2" fill="none" stroke-linecap="round" opacity=".5"/>
      <ellipse cx="92" cy="50" rx="5" ry="9" fill="#8b6aac" opacity=".7" transform="rotate(20 92 50)"/>
      <ellipse cx="12" cy="118" rx="4" ry="8" fill="#7a5fa0" opacity=".65" transform="rotate(-30 12 118)"/>
    </g>
  </svg>
  <svg class="flora-corner flora-tr" viewBox="0 0 280 340" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity=".9">
      <path d="M40 340 Q50 280 45 220 Q40 160 55 100 Q62 70 70 40" stroke="#5a7855" stroke-width="2" fill="none" stroke-linecap="round"/>
      <ellipse cx="22" cy="230" rx="18" ry="44" fill="#6b8c65" transform="rotate(-35 22 230)"/>
      <ellipse cx="18" cy="170" rx="16" ry="38" fill="#5a7855" transform="rotate(-28 18 170)"/>
      <ellipse cx="30" cy="110" rx="14" ry="32" fill="#7da877" transform="rotate(-20 30 110)"/>
      <ellipse cx="68" cy="200" rx="20" ry="46" fill="#6b8c65" transform="rotate(18 68 200)"/>
      <ellipse cx="72" cy="145" rx="16" ry="36" fill="#7da877" transform="rotate(24 72 145)"/>
      <ellipse cx="65" cy="88" rx="12" ry="28" fill="#5a7855" transform="rotate(15 65 88)"/>
      <circle cx="18" cy="188" r="10" fill="#7a5fa0" opacity=".8"/>
      <circle cx="74" cy="120" r="12" fill="#6a4f90" opacity=".8"/>
      <circle cx="56" cy="58" r="9" fill="#7a5fa0" opacity=".75"/>
      <ellipse cx="85" cy="70" rx="9" ry="20" fill="#8fba88" transform="rotate(30 85 70)"/>
      <path d="M55 100 Q80 80 90 55" stroke="#6b8c65" stroke-width="1.2" fill="none" stroke-linecap="round" opacity=".6"/>
      <ellipse cx="92" cy="50" rx="5" ry="9" fill="#8b6aac" opacity=".7" transform="rotate(20 92 50)"/>
    </g>
  </svg>
  <svg class="flora-corner flora-bl" viewBox="0 0 240 280" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity=".85">
      <path d="M35 0 Q42 60 40 120 Q38 180 50 240" stroke="#5a7855" stroke-width="1.8" fill="none" stroke-linecap="round"/>
      <ellipse cx="18" cy="55" rx="15" ry="38" fill="#6b8c65" transform="rotate(-22 18 55)"/>
      <ellipse cx="62" cy="80" rx="18" ry="42" fill="#7da877" transform="rotate(20 62 80)"/>
      <ellipse cx="20" cy="130" rx="14" ry="32" fill="#5a7855" transform="rotate(-15 20 130)"/>
      <ellipse cx="65" cy="155" rx="16" ry="38" fill="#6b8c65" transform="rotate(25 65 155)"/>
      <circle cx="65" cy="45" r="10" fill="#8b6aac" opacity=".78"/>
      <circle cx="16" cy="100" r="8" fill="#7a5fa0" opacity=".72"/>
      <circle cx="70" cy="120" r="11" fill="#6a4f90" opacity=".75"/>
      <path d="M42 60 Q20 45 12 28" stroke="#6b8c65" stroke-width="1" fill="none" stroke-linecap="round" opacity=".55"/>
    </g>
  </svg>
  <svg class="flora-corner flora-br" viewBox="0 0 240 280" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g opacity=".85">
      <path d="M35 0 Q42 60 40 120 Q38 180 50 240" stroke="#5a7855" stroke-width="1.8" fill="none" stroke-linecap="round"/>
      <ellipse cx="18" cy="55" rx="15" ry="38" fill="#6b8c65" transform="rotate(-22 18 55)"/>
      <ellipse cx="62" cy="80" rx="18" ry="42" fill="#7da877" transform="rotate(20 62 80)"/>
      <ellipse cx="20" cy="130" rx="14" ry="32" fill="#5a7855" transform="rotate(-15 20 130)"/>
      <ellipse cx="65" cy="155" rx="16" ry="38" fill="#6b8c65" transform="rotate(25 65 155)"/>
      <circle cx="65" cy="45" r="10" fill="#8b6aac" opacity=".78"/>
      <circle cx="16" cy="100" r="8" fill="#7a5fa0" opacity=".72"/>
      <circle cx="70" cy="120" r="11" fill="#6a4f90" opacity=".75"/>
    </g>
  </svg>

  <div class="env-photo-wrap">
    <img id="coverPhoto" src="img/portada.jpg" onerror="this.src='https://images.unsplash.com/photo-1519741497674-611481863552?w=800&q=80'" alt="Esteban y Erika">
    <div class="photo-names-overlay">Nuestra boda</div>
  </div>

  <div class="env-subtitle">Esteban Nossa &amp; Erika Arevalo</div>
  <div class="env-reserved">Hemos reservado</div>
  <div class="env-num">2</div>
  <div class="env-places">lugares en su honor</div>
  <div class="env-honor">26 &middot; 04 &middot; 2026</div>
  <div class="env-para">Invitacion especial para</div>
  <div class="env-gname" id="envGuestName">Querido invitado</div>

  <div class="env-scene" id="envScene" onclick="openEnvelope()">
    <div class="env-body-rect">
      <div class="eb-back"></div>
      <div class="eb-shine"></div>
      <div class="eb-cl"></div>
      <div class="eb-cr"></div>
      <div class="eb-inner" id="innerCard">
        <div class="ii-top">Save the date</div>
        <div class="ii-names">Esteban Nossa<br><span>&amp;</span><br>Erika Arevalo</div>
        <div class="ii-date">26 &middot; 04 &middot; 2026 &nbsp;&middot;&nbsp; 14:00 h</div>
      </div>
      <div class="eb-sl"></div>
      <div class="eb-sr"></div>
      <div class="eb-sb"></div>
      <div class="eb-flap" id="envFlap"></div>
      <div class="wax" id="wax">
        <div class="wax-inner">
          <div class="wax-text">E&amp;E<br><span style="font-size:8px;letter-spacing:.08em">2026</span></div>
        </div>
      </div>
    </div>
  </div>

  <p class="env-hint" id="envHint">Toca el sobre para abrir tu invitacion</p>
</div>

<!-- MAIN INVITATION -->
<div id="s3">
  <div class="hero">
    <div class="h-orb h-orb-a"></div>
    <div class="h-orb h-orb-b"></div>
    <svg class="hbot hbot-tl" viewBox="0 0 280 360" fill="none">
      <path d="M35 360 Q45 290 42 220 Q38 150 52 80 Q60 45 72 10" stroke="#5a7855" stroke-width="1.8" fill="none" stroke-linecap="round"/>
      <ellipse cx="18" cy="240" rx="16" ry="46" fill="#6b8c65" transform="rotate(-32 18 240)"/>
      <ellipse cx="14" cy="175" rx="14" ry="36" fill="#5a7855" transform="rotate(-25 14 175)"/>
      <ellipse cx="26" cy="108" rx="12" ry="30" fill="#7da877" transform="rotate(-18 26 108)"/>
      <ellipse cx="68" cy="210" rx="18" ry="44" fill="#6b8c65" transform="rotate(20 68 210)"/>
      <ellipse cx="72" cy="150" rx="15" ry="34" fill="#7da877" transform="rotate(26 72 150)"/>
      <circle cx="14" cy="194" r="9" fill="#7a5fa0" opacity=".75"/>
      <circle cx="74" cy="118" r="11" fill="#6a4f90" opacity=".75"/>
      <circle cx="54" cy="52" r="8" fill="#8b6aac" opacity=".7"/>
      <ellipse cx="86" cy="68" rx="8" ry="18" fill="#94b08d" transform="rotate(28 86 68)"/>
      <path d="M52 108 Q78 88 88 62" stroke="#6b8c65" stroke-width="1" fill="none" stroke-linecap="round" opacity=".55"/>
    </svg>
    <svg class="hbot hbot-tr" viewBox="0 0 280 360" fill="none">
      <path d="M35 360 Q45 290 42 220 Q38 150 52 80 Q60 45 72 10" stroke="#5a7855" stroke-width="1.8" fill="none" stroke-linecap="round"/>
      <ellipse cx="18" cy="240" rx="16" ry="46" fill="#6b8c65" transform="rotate(-32 18 240)"/>
      <ellipse cx="68" cy="210" rx="18" ry="44" fill="#6b8c65" transform="rotate(20 68 210)"/>
      <ellipse cx="72" cy="150" rx="15" ry="34" fill="#7da877" transform="rotate(26 72 150)"/>
      <circle cx="74" cy="118" r="11" fill="#6a4f90" opacity=".75"/>
      <circle cx="54" cy="52" r="8" fill="#8b6aac" opacity=".7"/>
    </svg>
    <svg class="hbot hbot-bl" viewBox="0 0 240 300" fill="none">
      <path d="M32 0 Q38 70 36 140 Q34 200 46 270" stroke="#5a7855" stroke-width="1.6" fill="none" stroke-linecap="round"/>
      <ellipse cx="16" cy="60" rx="13" ry="36" fill="#6b8c65" transform="rotate(-20 16 60)"/>
      <ellipse cx="58" cy="90" rx="16" ry="40" fill="#7da877" transform="rotate(22 58 90)"/>
      <ellipse cx="18" cy="145" rx="13" ry="30" fill="#5a7855" transform="rotate(-14 18 145)"/>
      <circle cx="60" cy="50" r="9" fill="#8b6aac" opacity=".75"/>
      <circle cx="14" cy="108" r="8" fill="#7a5fa0" opacity=".7"/>
    </svg>
    <svg class="hbot hbot-br" viewBox="0 0 240 300" fill="none">
      <path d="M32 0 Q38 70 36 140 Q34 200 46 270" stroke="#5a7855" stroke-width="1.6" fill="none" stroke-linecap="round"/>
      <ellipse cx="16" cy="60" rx="13" ry="36" fill="#6b8c65" transform="rotate(-20 16 60)"/>
      <ellipse cx="58" cy="90" rx="16" ry="40" fill="#7da877" transform="rotate(22 58 90)"/>
      <circle cx="60" cy="50" r="9" fill="#8b6aac" opacity=".75"/>
      <circle cx="14" cy="108" r="8" fill="#7a5fa0" opacity=".7"/>
    </svg>

    <div class="hero-photo">
      <svg class="hp-flora hp-fl-tl" viewBox="0 0 160 220" fill="none">
        <ellipse cx="35" cy="90" rx="14" ry="40" fill="#6b8c65" opacity=".85" transform="rotate(-18 35 90)"/>
        <ellipse cx="70" cy="68" rx="12" ry="34" fill="#94b08d" opacity=".75" transform="rotate(10 70 68)"/>
        <circle cx="35" cy="52" r="8" fill="#8b6aac" opacity=".7"/>
        <circle cx="72" cy="36" r="6" fill="#7a5fa0" opacity=".65"/>
      </svg>
      <svg class="hp-flora hp-fl-tr" viewBox="0 0 160 220" fill="none">
        <ellipse cx="35" cy="90" rx="14" ry="40" fill="#6b8c65" opacity=".85" transform="rotate(-18 35 90)"/>
        <ellipse cx="70" cy="68" rx="12" ry="34" fill="#94b08d" opacity=".75" transform="rotate(10 70 68)"/>
        <circle cx="72" cy="36" r="6" fill="#7a5fa0" opacity=".65"/>
      </svg>
      <img id="heroPhoto" src="img/portada.jpg" onerror="this.src='https://images.unsplash.com/photo-1519741497674-611481863552?w=1200&q=80'" alt="Esteban y Erika">
    </div>

    <div class="hero-content">
      <div class="h-nuestraboda">Nuestra boda</div>
      <h1 class="h-names">
        Esteban Nossa<br>
        <span class="h-amp">&amp;</span><br>
        Erika Arevalo
      </h1>
      <div class="h-div">
        <div class="h-line"></div>
        <svg class="h-leaf" width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M10 2 C10 2 2 8 2 14 C2 17 5.5 19 10 19 C14.5 19 18 17 18 14 C18 8 10 2 10 2Z" fill="#6b8c65" opacity=".7"/></svg>
        <div class="h-line"></div>
      </div>
      <div class="h-date">
        <div class="h-big">26 &middot; 04 &middot; 2026</div>
        <div class="h-sub">Lunes &middot; 14:00 horas &middot; Bogota, Colombia</div>
      </div>
      <p class="h-gnote" id="heroNote"></p>
    </div>
    <div class="scroll-cue">Descubre los detalles</div>
  </div>

  <div class="sec" id="sec0">
    <p class="sec-lbl">Con el corazon abierto</p>
    <h2 class="sec-title">Nos unimos para siempre<br>y queremos que estes ahi</h2>
    <p class="sec-prose">Con el alma llena de gratitud y emocion, Esteban y Erika tienen el honor de invitarte a compartir el dia mas importante de sus vidas. Tu presencia transformara este momento en un recuerdo eterno.</p>
  </div>

  <div class="ornament">&#10022; &nbsp; &#10022; &nbsp; &#10022;</div>

  <div class="sec" id="sec-gallery">
    <p class="sec-lbl">Nuestra historia</p>
    <h2 class="sec-title">Momentos que nos trajeron<br>hasta aqui</h2>
    <div class="gallery">
      <div class="g-cell wide"><img src="img/galeria-1.jpg" onerror="this.src='https://images.unsplash.com/photo-1529636444744-adffc9135a5e?w=900&q=80'" alt="Foto pareja"></div>
      <div class="g-cell"><img src="img/galeria-2.jpg" onerror="this.src='https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=600&q=80'" alt="Foto pareja 2"></div>
      <div class="g-cell"><img src="img/galeria-3.jpg" onerror="this.src='https://images.unsplash.com/photo-1606800052052-a08af7148866?w=600&q=80'" alt="Foto pareja 3"></div>
    </div>
  </div>

  <div class="ornament">&#10022; &nbsp; &#10022; &nbsp; &#10022;</div>

  <div class="sec" id="sec1">
    <p class="sec-lbl">El gran dia</p>
    <h2 class="sec-title">Programa de la celebracion</h2>
    <div class="timeline">
      <div class="t-row"><div class="t-ico"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg></div><div><div class="t-time">14:00 h</div><div class="t-event">Recepcion de invitados</div><div class="t-desc">Bienvenida con coctel, arreglos florales y musica en vivo.</div></div></div>
      <div class="t-row"><div class="t-ico"><svg viewBox="0 0 24 24"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6z"/></svg></div><div><div class="t-time">15:00 h</div><div class="t-event">Ceremonia</div><div class="t-desc">El momento mas esperado: dos vidas que se unen para siempre.</div></div></div>
      <div class="t-row"><div class="t-ico"><svg viewBox="0 0 24 24"><path d="M8 21h8M12 17v4M6.5 3h11l1 9a6 6 0 01-12 0l1-9z"/></svg></div><div><div class="t-time">16:30 h</div><div class="t-event">Brindis y fotografias</div><div class="t-desc">Celebracion con champagne y momentos especiales con los novios.</div></div></div>
      <div class="t-row"><div class="t-ico"><svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg></div><div><div class="t-time">18:00 h</div><div class="t-event">Banquete y baile</div><div class="t-desc">Cena, torta nupcial, vals nupcial y musica hasta la madrugada.</div></div></div>
    </div>
  </div>

  <div class="sec" id="sec2">
    <p class="sec-lbl">Como llegar</p>
    <h2 class="sec-title">Lugar de la celebracion</h2>
    <p class="sec-prose">Te esperamos en Bogota. Puedes llegar en carro particular o transporte publico.</p>
    <div class="map-card">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d127275.46386285832!2d-74.13369!3d4.6482!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e3f9bfd2da6cb29%3A0x239d635520a33914!2sBogot%C3%A1%2C%20Colombia!5e0!3m2!1ses!2sco!4v1700000000000" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="map-foot">
        <div class="map-addr"><strong>Bogota, Colombia</strong><span>Lunes 26 de abril de 2026 &middot; 14:00 h</span></div>
        <a class="btn btn-lilac" href="https://www.google.com/maps/search/salon+eventos+bogota" target="_blank">Como llegar</a>
      </div>
    </div>
  </div>

  <div class="sec" id="sec3">
    <p class="sec-lbl">Vestimenta</p>
    <h2 class="sec-title">Como venir vestido</h2>
    <p class="sec-prose">Dress code: Etiqueta formal. El verde salvia y el lila son los colores de la boda y de las damas de honor.</p>
    <div class="pal-card">
      <div>
        <div class="swatches">
          <div class="sw" style="background:#6b8c65"></div>
          <div class="sw" style="background:#7a5fa0"></div>
          <div class="sw" style="background:#b09ec4"></div>
          <div class="sw" style="background:#e8e5df"></div>
          <div class="sw" style="background:#c9b8a8"></div>
        </div>
        <p style="font-size:.69rem;color:#bbb;margin-top:9px;">Paleta de la boda</p>
      </div>
      <div class="pal-txt">
        <h3>Elegancia floral y natural</h3>
        <p>Verde salvia y lila son exclusivos para las damas de honor. Los invitados pueden elegir champagne, marfil, gris perla u otros tonos neutros y elegantes.</p>
        <p class="pal-note">El blanco esta reservado para la novia.</p>
        <br>
        <a class="btn btn-outline" href="https://www.pinterest.com/search/pins/?q=wedding+guest+outfit+lilac+sage+green+formal+elegant" target="_blank" style="font-size:.72rem;">Ideas en Pinterest</a>
      </div>
    </div>
  </div>

  <div class="sec" id="sec4">
    <p class="sec-lbl">RSVP</p>
    <h2 class="sec-title">Confirma tu asistencia</h2>
    <p class="sec-prose">Por favor confirma antes del <strong>26 de marzo de 2026</strong>. Esta invitacion es para exactamente <strong>2 personas</strong>.</p>
    <div class="form-card">
      <form id="rsvpForm">
        <div class="rsvp-notice">Esta invitacion es exclusiva para <strong>2 personas</strong>. Registra los datos de ambos asistentes.</div>
        <div class="g-slots">
          <div class="g-slot">
            <div class="g-slot-lbl">Invitado 1 &mdash; principal</div>
            <div class="slot-row">
              <input type="text" id="f_g1n" placeholder="Nombre" required>
              <input type="text" id="f_g1a" placeholder="Apellido" required>
            </div>
          </div>
          <div class="g-slot">
            <div class="g-slot-lbl">Invitado 2 &mdash; acompanante (opcional)</div>
            <div class="slot-row">
              <input type="text" id="f_g2n" placeholder="Nombre">
              <input type="text" id="f_g2a" placeholder="Apellido">
            </div>
          </div>
        </div>
        <div class="f-grid">
          <div class="f-field"><label>Telefono / WhatsApp</label><input type="tel" id="f_tel" placeholder="+57 300 000 0000"></div>
          <div class="f-field"><label>Correo electronico</label><input type="email" id="f_mail" placeholder="tu@correo.com"></div>
          <div class="f-field full">
            <label>Confirman su asistencia</label>
            <div class="radio-grp">
              <label class="r-opt"><input type="radio" name="attend" value="Si" required> Si, alli estaremos</label>
              <label class="r-opt"><input type="radio" name="attend" value="No"> No podremos asistir</label>
            </div>
          </div>
          <div class="f-field full"><label>Mensaje para los novios (opcional)</label><textarea id="f_msg" placeholder="Escribeles algo bonito..."></textarea></div>
        </div>
        <div class="f-submit">
          <button type="submit" class="btn btn-lilac" style="padding:15px 52px;font-size:.82rem;">Confirmar asistencia</button>
        </div>
      </form>
      <div class="form-ok" id="formOk">
        <div class="ok-title">Gracias por confirmar</div>
        <p id="okMsg">Esteban y Erika los esperan con el corazon abierto el 26 de abril.</p>
        <div class="download-section">
          <button class="btn btn-gold" onclick="downloadCSV()" style="font-size:.74rem;">Descargar confirmaciones (Excel / CSV)</button>
        </div>
        <p style="font-size:.72rem;color:#bbb;margin-top:10px;">El archivo se abre directamente en Excel o Google Sheets.</p>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="f-names">Esteban &amp; Erika</div>
    <div class="f-date">26 &middot; 04 &middot; 2026 &nbsp;&middot;&nbsp; Bogota, Colombia</div>
    <div class="f-sub">Hecho con amor para el dia mas especial</div>
  </footer>
</div>

<script>
/* ══════════════════════════════════════════════════
   PERSONALIZACIÓN POR URL
   
   Uso: invitacion_boda.html?para=Juan+Pérez
   o:   invitacion_boda.html?invitado=María+González
   
   El nombre se muestra directo en el sobre,
   sin que el invitado tenga que escribir nada.
   ══════════════════════════════════════════════════ */
let guestName = '';
let opened    = false;
let rsvpList  = JSON.parse(localStorage.getItem('rsvp_boda_2026') || '[]');

(function(){
  const p   = new URLSearchParams(location.search);
  const val = p.get('para') || p.get('invitado') || '';
  if(val){
    guestName = decodeURIComponent(val.replace(/\+/g,' '));
    document.getElementById('envGuestName').textContent = guestName;
    const parts = guestName.split(' ');
    if(parts[0]) document.getElementById('f_g1n').value = parts[0];
    if(parts.length > 1) document.getElementById('f_g1a').value = parts.slice(1).join(' ');
  }
})();

/* ═══ MUSIC ═══ */
let audioCtx = null;
let gainNode = null;
let musicPlaying = false;
let scheduleHandle = null;
let startTime = 0;
let noteIndex = 0;

const melody = [
  {n:'A4',d:1.2},{n:'C5',d:.6},{n:'E5',d:.6},
  {n:'G5',d:1.2},{n:'F5',d:.6},{n:'E5',d:.6},
  {n:'D5',d:.9},{n:'C5',d:.6},{n:'B4',d:.5},{n:'A4',d:1.4},
  {n:'A4',d:1.2},{n:'E5',d:.6},{n:'A5',d:.6},
  {n:'G5',d:.9},{n:'F5',d:.6},{n:'E5',d:.5},{n:'D5',d:1.4},
  {n:'C5',d:1.2},{n:'E5',d:.6},{n:'G5',d:.6},
  {n:'A5',d:1.4},{n:'G5',d:.6},{n:'F5',d:.4},{n:'E5',d:1.6},
  {n:'B4',d:.8},{n:'D5',d:.6},{n:'F5',d:.6},
  {n:'E5',d:.9},{n:'D5',d:.6},{n:'C5',d:.5},{n:'B4',d:1.2},
  {n:'C5',d:.8},{n:'E5',d:.6},{n:'A5',d:.6},
  {n:'G5',d:1.2},{n:'F5',d:.6},{n:'E5',d:.6},{n:'D5',d:1.4},
  {n:'A4',d:1.6},{n:'C5',d:.6},{n:'E5',d:.8},
  {n:'A5',d:1.8},{n:'G5',d:.5},{n:'E5',d:.5},{n:'C5',d:2.0},
];

const freq = {
  'A3':220,'B3':246.9,'C4':261.6,'D4':293.7,'E4':329.6,'F4':349.2,'G4':392,
  'A4':440,'B4':493.9,'C5':523.3,'D5':587.3,'E5':659.3,'F5':698.5,'G5':784,
  'A5':880,'B5':987.8,'C6':1046.5
};

function pianoNote(ctx, f, when, dur, vol){
  const osc  = ctx.createOscillator();
  const gain = ctx.createGain();
  const harm = ctx.createOscillator();
  const hg   = ctx.createGain();
  osc.type  = 'sine';
  osc.frequency.value = f;
  harm.type = 'sine';
  harm.frequency.value = f * 2.98;
  hg.gain.value = 0.04;
  gain.gain.setValueAtTime(0, when);
  gain.gain.linearRampToValueAtTime(vol, when + 0.02);
  gain.gain.exponentialRampToValueAtTime(vol * 0.6, when + dur * 0.35);
  gain.gain.exponentialRampToValueAtTime(0.0001, when + dur * 0.95);
  osc.connect(gain);
  harm.connect(hg);
  hg.connect(gainNode);
  gain.connect(gainNode);
  osc.start(when); osc.stop(when + dur);
  harm.start(when); harm.stop(when + dur);
}

function scheduleNotes(){
  if(!musicPlaying) return;
  const LOOK_AHEAD = 0.18;
  const now = audioCtx.currentTime;
  while(startTime < now + LOOK_AHEAD){
    const note = melody[noteIndex % melody.length];
    pianoNote(audioCtx, freq[note.n], startTime, note.d * 0.82, 0.18);
    startTime += note.d * 0.82;
    noteIndex++;
  }
  scheduleHandle = setTimeout(scheduleNotes, 80);
}

function startMusic(){
  if(musicPlaying) return;
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0;
    gainNode.connect(audioCtx.destination);
  }
  if(audioCtx.state === 'suspended') audioCtx.resume();
  musicPlaying = true;
  startTime = audioCtx.currentTime + 0.1;
  noteIndex = 0;
  gainNode.gain.cancelScheduledValues(audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
  gainNode.gain.linearRampToValueAtTime(0.8, audioCtx.currentTime + 2.5);
  scheduleNotes();
  document.getElementById('musicBtn').classList.add('on');
  document.getElementById('musicIcon').innerHTML = '<line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23M12 20v4M8 20h8"/>';
}

function stopMusic(){
  if(!musicPlaying) return;
  musicPlaying = false;
  clearTimeout(scheduleHandle);
  gainNode.gain.cancelScheduledValues(audioCtx.currentTime);
  gainNode.gain.setValueAtTime(gainNode.gain.value, audioCtx.currentTime);
  gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1.2);
  document.getElementById('musicBtn').classList.remove('on');
  document.getElementById('musicIcon').innerHTML = '<path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>';
}

function toggleMusic(){
  musicPlaying ? stopMusic() : startMusic();
}

/* ═══ ENVELOPE ═══ */
function openEnvelope(){
  if(opened) return;
  opened = true;
  startMusic();
  document.getElementById('wax').classList.add('gone');
  document.getElementById('envFlap').classList.add('open');
  document.getElementById('envHint').classList.add('gone');
  document.getElementById('envScene').style.cursor = 'default';
  setTimeout(() => { document.getElementById('innerCard').classList.add('vis'); }, 680);
  setTimeout(() => { transitionToMain(); }, 2400);
}

/* ═══ TRANSITION ═══ */
function transitionToMain(){
  const s2 = document.getElementById('s2');
  s2.style.transition = 'opacity 1s ease';
  s2.style.opacity = '0';
  setTimeout(() => { s2.classList.add('off'); }, 1000);

  const s3 = document.getElementById('s3');
  s3.classList.add('active');
  s3.style.opacity = '0';
  s3.style.transition = 'opacity 1s ease';
  requestAnimationFrame(() => requestAnimationFrame(() => { s3.style.opacity = '1'; }));

  if(guestName)
    document.getElementById('heroNote').textContent = 'Invitacion especial para ' + guestName;

  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('vis'); });
  }, { threshold: .1 });
  document.querySelectorAll('.sec').forEach(el => obs.observe(el));
}

/* ═══ RSVP ═══ */
document.getElementById('rsvpForm').addEventListener('submit', function(e){
  e.preventDefault();
  const attend = document.querySelector('input[name="attend"]:checked');
  const g1n  = document.getElementById('f_g1n').value.trim();
  const g1a  = document.getElementById('f_g1a').value.trim();
  const g2n  = document.getElementById('f_g2n').value.trim();
  const g2a  = document.getElementById('f_g2a').value.trim();
  const tel  = document.getElementById('f_tel').value.trim();
  const mail = document.getElementById('f_mail').value.trim();
  const msg  = document.getElementById('f_msg').value.trim();

  rsvpList.push({
    fecha: new Date().toLocaleString('es-CO'),
    invitado_link: guestName || (g1n + ' ' + g1a),
    inv1_nombre: g1n, inv1_apellido: g1a,
    inv2_nombre: g2n, inv2_apellido: g2a,
    telefono: tel, correo: mail,
    asistencia: attend ? attend.value : '',
    mensaje: msg
  });
  localStorage.setItem('rsvp_boda_2026', JSON.stringify(rsvpList));

  let ok = 'Esteban y Erika los esperan con el corazon abierto el 26 de abril.';
  if(g1n && g2n) ok = `${g1n} y ${g2n}, los esperamos con todo nuestro amor el 26 de abril.`;
  else if(g1n)   ok = `${g1n}, te esperamos con todo nuestro amor el 26 de abril.`;
  document.getElementById('okMsg').textContent = ok;

  this.style.display = 'none';
  const okEl = document.getElementById('formOk');
  okEl.style.display  = 'block';
  okEl.style.opacity  = '0';
  okEl.style.transition = 'opacity .6s';
  requestAnimationFrame(() => requestAnimationFrame(() => { okEl.style.opacity = '1'; }));
});

/* ═══ CSV DOWNLOAD ═══ */
function downloadCSV(){
  if(!rsvpList.length){ alert('No hay confirmaciones aun.'); return; }
  const h = ['Fecha','Invitado (link)','Inv1 Nombre','Inv1 Apellido','Inv2 Nombre','Inv2 Apellido','Telefono','Correo','Asistencia','Mensaje'];
  const rows = rsvpList.map(r =>
    [r.fecha,r.invitado_link,r.inv1_nombre,r.inv1_apellido,r.inv2_nombre,r.inv2_apellido,r.telefono,r.correo,r.asistencia,r.mensaje]
    .map(v => `"${(v||'').replace(/"/g,'""')}"`)
  );
  const csv  = '\uFEFF' + [h.join(','), ...rows.map(r => r.join(','))].join('\r\n');
  const a    = document.createElement('a');
  a.href     = URL.createObjectURL(new Blob([csv], {type:'text/csv;charset=utf-8;'}));
  a.download = `confirmaciones_boda_esteban_erika_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
}
</script>
</body>
</html>
